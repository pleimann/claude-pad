# Gesture Detection & Config Push Design

## Overview

Add double-press and long-press gesture detection to the CircuitPython client, with keycodes driven by the same `config.yaml` used by the Go middleware. A new `config-push` command syncs configuration to the device.

## CircuitPython Config Format

The Go middleware generates `config.py` on the CIRCUITPY drive:

```python
# config.py - Auto-generated by camel-pad, do not edit manually
from adafruit_hid.keycode import Keycode

TIMING = {
    "double_press_window_ms": 300,
    "long_press_threshold_ms": 500,
}

BUTTONS = {
    0: {  # boot button
        "press": [Keycode.CONTROL, Keycode.GRAVE_ACCENT],
        "double_press": [Keycode.CONTROL, Keycode.Z],
        "long_press": [Keycode.ESCAPE],
    },
}
```

## Gesture Detection State Machine

```
IDLE ──press──> PRESSED
                   │
                   ├──held > threshold──> emit LONG_PRESS ──> IDLE
                   │
                   └──release (short)──> WAIT_DOUBLE
                                            │
                                            ├──timeout──> emit PRESS ──> IDLE
                                            │
                                            └──press──> DOUBLE_PRESSED
                                                           │
                                                           └──release──> emit DOUBLE_PRESS ──> IDLE
```

Behaviors:
- **Long press**: Fires immediately when threshold reached (while held)
- **Single press**: Fires after double-press window expires
- **Double press**: Fires on release of second press

## Go `config-push` Command

```
$ ./camel-pad config-push
Reading config from config.yaml...
Converting 4 button mappings...
Found CIRCUITPY at /Volumes/CIRCUITPY
Writing config.py...
Done! Restart your device to apply changes.
```

### Key Mapping Conversion

| YAML | Python |
|------|--------|
| `"ctrl+c"` | `[Keycode.CONTROL, Keycode.C]` |
| `"enter"` | `[Keycode.ENTER]` |
| `"ctrl+shift+z"` | `[Keycode.CONTROL, Keycode.SHIFT, Keycode.Z]` |

### CIRCUITPY Drive Detection

- macOS: `/Volumes/CIRCUITPY`
- Linux: `/media/$USER/CIRCUITPY` or `/run/media/$USER/CIRCUITPY`
- Windows: Scan drive letters for volume label `CIRCUITPY`

## Files to Create/Modify

### New Files
- `internal/configpush/push.go` - Config conversion and drive detection
- `internal/configpush/keymap.go` - YAML key string to Python Keycode mapping

### Modified Files
- `cmd/camel-pad/main.go` - Add `config-push` subcommand
- `pad/code.py` - Gesture detection state machine
- `pad/config.py` - Generated (not committed)

## Implementation Order

1. Create keymap conversion (Go)
2. Create CIRCUITPY drive detection (Go)
3. Implement `config-push` command (Go)
4. Update CircuitPython gesture detection
5. Test end-to-end
